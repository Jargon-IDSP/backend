generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Category {
  id               Int               @id @default(autoincrement())
  name             String
  userId           String?
  isDefault        Boolean           @default(false)
  user             User?             @relation(fields: [userId], references: [id], onDelete: Cascade)
  customFlashcards CustomFlashcard[]
  customQuestions  CustomQuestion[]
  customQuizzes    CustomQuiz[]
  documents        Document[]

  @@unique([name, userId])
  @@index([userId])
  @@index([isDefault])
  @@index([userId, isDefault])
  @@map("categories")
}

model Industry {
  id                     Int                          @id @default(autoincrement())
  name                   String                       @unique
  badges                 Badge[]
  flashcards             Flashcard[]
  prebuiltQuizzes        PrebuiltQuiz[]
  apprenticeshipProgress UserApprenticeshipProgress[]
  users                  User[]

  @@map("industries")
}

model Level {
  id                     Int                          @id @default(autoincrement())
  name                   String                       @unique
  badges                 Badge[]
  flashcards             Flashcard[]
  prebuiltQuizzes        PrebuiltQuiz[]
  apprenticeshipProgress UserApprenticeshipProgress[]
  quizAttempts           UserQuizAttempt[]

  @@map("levels")
}

model Flashcard {
  id                String     @id
  termEnglish       String     @db.Text
  termFrench        String     @db.Text
  termChinese       String     @db.Text
  termSpanish       String     @db.Text
  termTagalog       String     @db.Text
  termPunjabi       String     @db.Text
  termKorean        String     @db.Text
  definitionEnglish String     @db.Text
  definitionFrench  String     @db.Text
  definitionChinese String     @db.Text
  definitionSpanish String     @db.Text
  definitionTagalog String     @db.Text
  definitionPunjabi String     @db.Text
  definitionKorean  String     @db.Text
  industryId        Int?
  levelId           Int
  industry          Industry?  @relation(fields: [industryId], references: [id])
  level             Level      @relation(fields: [levelId], references: [id])
  questions         Question[] @relation("QuestionCorrectAnswer")

  @@index([levelId, industryId])
  @@index([industryId, levelId])
  @@index([levelId])
  @@index([termEnglish(length: 255)])
  @@map("flashcards")
}

model Question {
  id            String    @id
  correctTermId String
  promptEnglish String    @db.Text
  promptFrench  String    @db.Text
  promptChinese String    @db.Text
  promptSpanish String    @db.Text
  promptTagalog String    @db.Text
  promptPunjabi String    @db.Text
  promptKorean  String    @db.Text
  difficulty    Int
  tags          String    @db.Text
  points        Int       @default(5)
  correctAnswer Flashcard @relation("QuestionCorrectAnswer", fields: [correctTermId], references: [id])

  @@index([correctTermId], map: "questions_correctTermId_fkey")
  @@index([difficulty])
  @@index([points])
  @@map("questions")
}

model PrebuiltQuiz {
  id                  String            @id @default(cuid())
  templateId          String            @unique
  levelId             Int
  industryId          Int?
  quizNumber          Int
  name                String            @db.Text
  description         String?           @db.Text
  quizType            QuizType
  questionsPerQuiz    Int               @default(10)
  allowAIHelp         Boolean           @default(true)
  allowTranslation    Boolean           @default(true)
  allowBackNavigation Boolean           @default(true)
  pointsPerQuestion   Int               @default(10)
  requiredToUnlock    Boolean           @default(false)
  passingScore        Int?
  industry            Industry?         @relation(fields: [industryId], references: [id])
  level               Level             @relation(fields: [levelId], references: [id])
  attempts            UserQuizAttempt[]

  @@unique([levelId, industryId, quizNumber])
  @@index([levelId])
  @@index([levelId, industryId])
  @@index([quizType])
  @@index([quizNumber])
  @@index([industryId], map: "prebuilt_quizzes_industryId_fkey")
  @@map("prebuilt_quizzes")
}

model Badge {
  id          String      @id @default(cuid())
  code        String      @unique
  name        String      @db.Text
  description String      @db.Text
  iconUrl     String?
  levelId     Int?
  industryId  Int?
  industry    Industry?   @relation(fields: [industryId], references: [id])
  level       Level?      @relation(fields: [levelId], references: [id])
  userBadges  UserBadge[]

  @@index([levelId])
  @@index([industryId])
  @@index([levelId, industryId])
  @@map("badges")
}

model UserBadge {
  id       String   @id @default(cuid())
  userId   String
  badgeId  String
  earnedAt DateTime @default(now())
  badge    Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId])
  @@index([badgeId])
  @@index([earnedAt])
  @@map("user_badges")
}

model UserApprenticeshipProgress {
  id               String    @id @default(cuid())
  userId           String
  levelId          Int
  industryId       Int       @default(6)
  quizzesCompleted Int       @default(0)
  isLevelComplete  Boolean   @default(false)
  unlockedAt       DateTime  @default(now())
  completedAt      DateTime?
  industry         Industry  @relation(fields: [industryId], references: [id])
  level            Level     @relation(fields: [levelId], references: [id])
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, levelId, industryId])
  @@index([userId])
  @@index([userId, levelId])
  @@index([levelId, industryId])
  @@index([isLevelComplete])
  @@index([industryId], map: "user_apprenticeship_progress_industryId_fkey")
  @@map("user_apprenticeship_progress")
}

model Document {
  id            String               @id @default(cuid())
  filename      String
  fileKey       String
  fileUrl       String
  fileType      String
  fileSize      Int?
  extractedText String?              @db.Text
  ocrProcessed  Boolean              @default(false)
  userId        String
  categoryId    Int                  @default(6)
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  flashcards    CustomFlashcard[]
  customQuizzes CustomQuiz[]
  translation   DocumentTranslation?
  category      Category             @relation(fields: [categoryId], references: [id])
  user          User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([categoryId])
  @@index([createdAt])
  @@index([ocrProcessed])
  @@index([userId, createdAt])
  @@index([userId, categoryId])
  @@index([userId, ocrProcessed])
  @@map("documents")
}

model DocumentTranslation {
  id          String   @id @default(cuid())
  documentId  String   @unique
  userId      String
  textEnglish String   @db.LongText
  textFrench  String   @db.LongText
  textChinese String   @db.LongText
  textSpanish String   @db.LongText
  textTagalog String   @db.LongText
  textPunjabi String   @db.LongText
  textKorean  String   @db.LongText
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  document    Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([userId])
  @@map("document_translations")
}

model CustomFlashcard {
  id                String           @id @default(cuid())
  documentId        String?
  userId            String
  categoryId        Int              @default(6)
  termEnglish       String           @db.Text
  termFrench        String           @db.Text
  termChinese       String           @db.Text
  termSpanish       String           @db.Text
  termTagalog       String           @db.Text
  termPunjabi       String           @db.Text
  termKorean        String           @db.Text
  definitionEnglish String           @db.Text
  definitionFrench  String           @db.Text
  definitionChinese String           @db.Text
  definitionSpanish String           @db.Text
  definitionTagalog String           @db.Text
  definitionPunjabi String           @db.Text
  definitionKorean  String           @db.Text
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  category          Category         @relation(fields: [categoryId], references: [id])
  document          Document?        @relation(fields: [documentId], references: [id], onDelete: Cascade)
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  questions         CustomQuestion[] @relation("CustomQuestionCorrectAnswer")

  @@index([userId, createdAt])
  @@index([documentId, createdAt])
  @@index([categoryId])
  @@index([termEnglish(length: 255)])
  @@map("custom_flashcards")
}

model CustomQuestion {
  id            String          @id @default(cuid())
  userId        String
  customQuizId  String?
  correctTermId String
  categoryId    Int             @default(6)
  promptEnglish String          @db.Text
  promptFrench  String          @db.Text
  promptChinese String          @db.Text
  promptSpanish String          @db.Text
  promptTagalog String          @db.Text
  promptPunjabi String          @db.Text
  promptKorean  String          @db.Text
  pointsWorth   Int             @default(10)
  createdAt     DateTime        @default(now())
  category      Category        @relation(fields: [categoryId], references: [id])
  correctAnswer CustomFlashcard @relation("CustomQuestionCorrectAnswer", fields: [correctTermId], references: [id], onDelete: Cascade)
  customQuiz    CustomQuiz?     @relation(fields: [customQuizId], references: [id])
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([customQuizId, createdAt])
  @@index([categoryId])
  @@index([correctTermId])
  @@map("custom_questions")
}

model CustomQuiz {
  id                String            @id @default(cuid())
  userId            String
  documentId        String?
  name              String
  categoryId        Int               @default(6)
  pointsPerQuestion Int               @default(10)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  questions         CustomQuestion[]
  sharedWith        CustomQuizShare[]
  category          Category          @relation(fields: [categoryId], references: [id])
  document          Document?         @relation(fields: [documentId], references: [id], onDelete: Cascade)
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  attempts          UserQuizAttempt[]

  @@index([userId])
  @@index([categoryId])
  @@index([documentId])
  @@index([userId, createdAt])
  @@index([userId, categoryId])
  @@map("custom_quizzes")
}

model CustomQuizShare {
  id               String              @id @default(cuid())
  customQuizId     String
  sharedWithUserId String
  sharedAt         DateTime            @default(now())
  status           LessonRequestStatus @default(PENDING)
  updatedAt        DateTime            @updatedAt
  customQuiz       CustomQuiz          @relation(fields: [customQuizId], references: [id], onDelete: Cascade)
  sharedWith       User                @relation("SharedCustomQuizzes", fields: [sharedWithUserId], references: [id], onDelete: Cascade)

  @@unique([customQuizId, sharedWithUserId])
  @@index([customQuizId])
  @@index([sharedWithUserId])
  @@index([status])
  @@index([customQuizId, status])
  @@map("custom_quiz_shares")
}

model UserQuizAttempt {
  id                String        @id @default(cuid())
  userId            String
  customQuizId      String?
  prebuiltQuizId    String?
  levelId           Int?
  questionIds       String?       @db.Text
  questionsAnswered Int           @default(0)
  questionsCorrect  Int           @default(0)
  totalQuestions    Int
  percentComplete   Int           @default(0)
  percentCorrect    Int           @default(0)
  pointsEarned      Int           @default(0)
  maxPossiblePoints Int
  completed         Boolean       @default(false)
  startedAt         DateTime      @default(now())
  completedAt       DateTime?
  customQuiz        CustomQuiz?   @relation(fields: [customQuizId], references: [id], onDelete: Cascade)
  level             Level?        @relation(fields: [levelId], references: [id])
  prebuiltQuiz      PrebuiltQuiz? @relation(fields: [prebuiltQuizId], references: [id], onDelete: Cascade)
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([customQuizId])
  @@index([prebuiltQuizId])
  @@index([levelId])
  @@index([completed])
  @@index([userId, completed])
  @@index([userId, customQuizId])
  @@index([userId, prebuiltQuizId])
  @@index([userId, levelId])
  @@index([userId, completedAt])
  @@map("user_quiz_attempts")
}

model UserWeeklyStats {
  id            String   @id @default(cuid())
  userId        String
  weekStartDate DateTime
  weeklyScore   Int      @default(0)
  daysActive    String   @default("")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, weekStartDate])
  @@index([userId])
  @@index([weekStartDate])
  @@index([weeklyScore])
  @@map("user_weekly_stats")
}

model User {
  id                     String                       @id
  email                  String
  firstName              String?
  lastName               String?
  username               String?
  language               String                       @default("english")
  industryId             Int                          @default(6)
  onboardingCompleted    Boolean                      @default(false)
  introductionViewed     Boolean                      @default(false)
  score                  Int                          @default(0)
  defaultPrivacy         PrivacyVisibility            @default(PRIVATE)
  createdAt              DateTime                     @default(now())
  updatedAt              DateTime                     @updatedAt
  facebookUrl            String?
  indeedUrl              String?
  instagramUrl           String?
  linkedinUrl            String?
  customCategories       Category[]
  customFlashcards       CustomFlashcard[]
  customQuestions        CustomQuestion[]
  sharedQuizzes          CustomQuizShare[]            @relation("SharedCustomQuizzes")
  customQuizzes          CustomQuiz[]
  documentTranslations   DocumentTranslation[]
  documents              Document[]
  following              Follow[]                     @relation("UserFollowing")
  followers              Follow[]                     @relation("UserFollowers")
  notifications          Notification[]
  apprenticeshipProgress UserApprenticeshipProgress[]
  avatar                 UserAvatar?
  badges                 UserBadge[]
  quizAttempts           UserQuizAttempt[]
  weeklyStats            UserWeeklyStats[]
  industry               Industry                     @relation(fields: [industryId], references: [id])

  @@index([email])
  @@index([score])
  @@index([industryId])
  @@index([language])
  @@map("users")
}

model UserAvatar {
  id            String   @id @default(cuid())
  userId        String   @unique
  unlockedItems String?  @db.Text
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  accessories   String?  @db.Text
  body          String   @default("body-1")
  bodyColor     String?  @default("#FFB6C1")
  clothing      String?
  expression    String?
  eyewear       String?
  facial        String?
  hair          String?
  headwear      String?
  shoes         String?
  hairColor     String?  @default("#512e14")
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_avatars")
}

model Follow {
  id          String       @id @default(cuid())
  followerId  String
  followingId String
  status      FollowStatus @default(FOLLOWING)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  follower    User         @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  following   User         @relation("UserFollowers", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
  @@index([status])
  @@index([followerId, status])
  @@index([followingId, status])
  @@map("follows")
}

model Notification {
  id              String           @id @default(cuid())
  userId          String
  type            NotificationType
  title           String
  message         String           @db.Text
  actionUrl       String?
  documentId      String?
  followId        String?
  lessonRequestId String?
  isRead          Boolean          @default(false)
  createdAt       DateTime         @default(now())
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isRead])
  @@index([createdAt])
  @@index([userId, createdAt])
  @@map("notifications")
}

enum FollowStatus {
  FOLLOWING
  BLOCKED
}

enum PrivacyVisibility {
  PRIVATE
  FRIENDS
  PUBLIC
}

enum QuizType {
  TERM_TO_TRANSLATION
  TRANSLATION_TO_DEFINITION
  MIXED_QUESTIONS
  BOSS_QUIZ
}

enum LessonRequestStatus {
  PENDING
  ACCEPTED
  DENIED
}

enum NotificationType {
  DOCUMENT_READY
  DOCUMENT_ERROR
  DOCUMENT_PROCESSING
  FRIEND_REQUEST
  LESSON_APPROVED
  QUIZ_SHARED
}
